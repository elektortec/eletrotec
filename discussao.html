<!-- Formulário para novo tópico (parte do body, substitua o antigo) -->
<div class="new-thread-form">
  <h2>Criar Novo Tópico</h2>
  <button id="login-github" class="btn" style="background: #24292e; margin-bottom: 1rem;">Login com GitHub para Postar</button>
  <form id="new-discussion-form" style="display: none;">
    <div class="form-group">
      <label for="title">Título do Tópico *</label>
      <input type="text" id="title" name="title" required placeholder="Ex: Problema com multímetro" />
    </div>
    <div class="form-group">
      <label for="body">Descrição *</label>
      <textarea id="body" name="body" required placeholder="Explique sua dúvida..."></textarea>
    </div>
    <div class="form-group">
      <label for="category">Categoria</label>
      <select id="category" name="category">
        <option value="general">Dúvidas Gerais</option>
        <option value="projects">Projetos e Esquemas</option>
        <option value="suggestions">Sugestões</option>
      </select>
    </div>
    <button type="submit" class="btn">Publicar Tópico no Fórum</button>
  </form>
  <div id="form-message" class="success" style="display: none;">Tópico criado com sucesso! <a href="https://github.com/elektortec/eletrotec/discussions" target="_blank">Ver no Fórum</a></div>
  <div id="form-error" class="error" style="display: none;">Erro: Tente logar novamente.</div>
</div>

<!-- Script atualizado (substitua o antigo script) -->
<script>
  const repo = "elektortec/eletrotec"; // Seu repo
  const CLIENT_ID = "SEU_CLIENT_ID_AQUI"; // MUDE pelo seu Client ID
  const CLIENT_SECRET = "SEU_CLIENT_SECRET_AQUI"; // MUDE (mantenha secreto!)
  const form = document.getElementById("new-discussion-form");
  const loginBtn = document.getElementById("login-github");
  const success = document.getElementById("form-message");
  const error = document.getElementById("form-error");
  let accessToken = localStorage.getItem("github_token"); // Armazena token no browser

  // Login com GitHub
  loginBtn.addEventListener("click", () => {
    window.location.href = `https://github.com/login/oauth/authorize?client_id=${CLIENT_ID}&scope=write:discussion`;
  });

  // Verifica token após login (GitHub redireciona com code)
  if (window.location.search.includes("code")) {
    const code = new URLSearchParams(window.location.search).get("code");
    fetch(`https://github.com/login/oauth/access_token?client_id=${CLIENT_ID}&client_secret=${CLIENT_SECRET}&code=${code}`, {
      method: "POST",
      headers: { Accept: "application/json" }
    })
    .then(r => r.json())
    .then(data => {
      if (data.access_token) {
        accessToken = data.access_token;
        localStorage.setItem("github_token", accessToken);
        form.style.display = "block";
        loginBtn.style.display = "none";
        history.replaceState(null, null, window.location.pathname); // Limpa URL
      }
    })
    .catch(() => error.style.display = "block");
  }

  if (accessToken) {
    form.style.display = "block";
    loginBtn.style.display = "none";
  }

  // Envia para Discussions
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const title = document.getElementById("title").value;
    const body = document.getElementById("body").value;
    const category = document.getElementById("category").value;

    fetch(`https://api.github.com/repos/${repo}/discussions`, {
      method: "POST",
      headers: {
        Authorization: `token ${accessToken}`,
        Accept: "application/vnd.github.v3+json",
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        title: title,
        body: body,
        category: category === "general" ? "general-discussion" : category // Ajuste se necessário
      })
    })
    .then(r => r.json())
    .then(data => {
      if (data.id) {
        success.style.display = "block";
        form.reset();
        // Recarrega lista de tópicos (chame a função de load aqui se quiser)
      } else {
        error.style.display = "block";
      }
    })
    .catch(() => error.style.display = "block");
  });

  // Carregamento de tópicos (mesmo de antes, adicione se quiser)
  // ... (cole o fetch de discussions aqui)
</script>
